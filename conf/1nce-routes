#!/bin/sh
# Dieses Skript wird beim Hochfahren von ppp0 ausgeführt
# und setzt Routen für alle 1NCE-Server dynamisch

# Prüfen, ob das Interface ppp0 ist
[ "$PPP_IFACE" = "ppp0" ] || exit 0

# Liste der 1NCE-Hostnamen
HOSTNAMES="udp.os.1nce.com coap.os.1nce.com lwm2m.os.1nce.com"

# Alle Hostnamen auflösen und Route setzen
for host in $HOSTNAMES; do
    IP=$(nslookup $host | awk '/^Address: / { print $2 }' | head -n1)
    if [ -n "$IP" ]; then
        # Prüfen, ob Route schon existiert
        if ! ip route show | grep -q "$IP"; then
            ip route add $IP dev $PPP_IFACE
            echo "Route gesetzt: $IP über $PPP_IFACE"
        fi
    else
        echo "DNS-Auflösung fehlgeschlagen für $host"
    fi
done
# 2️Mlulticast blocken
iptables -A OUTPUT -o $PPP_IFACE -d 239.2.1.1 -j DROP
echo "Multicast 239.2.1.1 über $PPP_IFACE geblockt"
